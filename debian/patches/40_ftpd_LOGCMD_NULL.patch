2006-10-21  Guillem Jover  <guillem@hadrons.org>

	* ftpd/ftpd.c (store): Do not overwrite `name' with gunique's return
	value, to avoid passing NULL to LOGCMD.


Index: b/ftpd/ftpd.c
===================================================================
--- a/ftpd/ftpd.c
+++ b/ftpd/ftpd.c
@@ -934,11 +934,17 @@ store (const char *name, const char *mod
   struct stat st;
   int (*closefunc) (FILE *);
 
-  if (unique && stat (name, &st) == 0
-      && (name = gunique (name)) == NULL)
+  if (unique && stat (name, &st) == 0)
     {
-      LOGCMD (*mode == 'w' ? "put" : "append", name);
-      return;
+      const char *name_unique = gunique (name);
+
+      if (name_unique)
+        name = name_unique;
+      else
+        {
+          LOGCMD (*mode == 'w' ? "put" : "append", name);
+          return;
+        }
     }
 
   if (restart_point)
